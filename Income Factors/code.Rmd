```{r}
# Load libraries
library(tidyverse)
library(car)        # For VIF 
library(ggplot2)    # For visualisations
library(arm)  # For the display() function to see linear model outputs
library(dplyr)
```

```{r}
# Load data
inc_data <- read.csv("dataset/INC.csv", stringsAsFactors= TRUE)
#summary(inc_data)
```

```{r}
inc_data <- subset(inc_data, select = -NSID)
colnames(inc_data)
```

Categorical variables, define as factor
```{r}
inc_data <- inc_data %>%
  mutate(across(c("W1wrk1aMP", "W1condur5MP", "W1hea2MP", "W1NoldBroHS", "W1InCarHH", "W1hous12HH", "W1usevcHH", "W1hiqualmum", "W1hiqualdad", "W1wrkfulldad", "W1wrkfullmum", "W1empsmum", "W1empsdad", "W1ch0_2HH","W1ch3_11HH", "W1ch12_15HH", "W1ch16_17HH", "IndSchool", "W1marstatmum", "W1depkids", "W1famtyp2", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1truantYP", "W1alceverYP", "W1bulrc", "W1disabYP", "W2disc1YP", "W2depressYP", "W4AlcFreqYP", "W4CannTryYP", "W4NamesYP", "W4RacismYP", "W4empsYP", "W4Childck1YP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6EducYP", "W6acqno", "W6gcse", "W6als", "W6OwnchiDV", "W6NEETAct", "W8DMARSTAT","W8TENURE", "W8DACTIVITYC", "W8DWRK", "W8CMSEX", "W8QMAFI", "W8DACTIVITY"), as.factor))
```

Continuous variables, define as numeric and rename negatives as NA
```{r}
inc_data <- inc_data %>%
  mutate(across(c( "W1GrssyrMP", "W1GrssyrHH", "W1yschat1", "W2ghq12scr", "W4schatYP","W6DebtattYP", "W8DGHQSC", "W8QDEB2", "W8DINCW"  
), as.numeric))

continuous_vars <- c("W1GrssyrMP", "W1GrssyrHH", "W1yschat1", "W2ghq12scr", 
                     "W4schatYP", "W6DebtattYP", "W8DGHQSC", "W8QDEB2", "W8DINCW")

for (var in continuous_vars) {
  inc_data[[var]][inc_data[[var]] < 0] <- NA  
}
summary(inc_data)
```



Boxplots for every categorical variable:
```{r}
# W1wrk1aMP - MP: current working status
ggplot(inc_data, aes(x=W1wrk1aMP, y=W8DINCW, fill=W1wrk1aMP)) +
    geom_boxplot() +
    labs(title="Income by MP: current working status", x="Work Status", y="Income at 25")

# W1condur5MP - Whether there is a computer in HH
ggplot(inc_data, aes(x=W1condur5MP, y=W8DINCW, fill=W1condur5MP)) +
    geom_boxplot() +
    labs(title="Income by Whether there is a computer in HH", x="computer in HH", y="Income at 25")

# W1hea2MP - Londstanding illness/disability
ggplot(inc_data, aes(x=W1hea2MP, y=W8DINCW, fill=W1hea2MP)) +
    geom_boxplot() +
    labs(title="Income by Longterm Disability", x="Work Duration", y="Income at 25")

# W1NoldBroHS - Number of younger siblings
ggplot(inc_data, aes(x=factor(W1NoldBroHS), y=W8DINCW, fill=factor(W1NoldBroHS))) +
    geom_boxplot() +
    labs(title="Income by Number of younger siblings", x="Younger Siblings", y="Income at 25")

# W1InCarHH - Whether YP is living in a private HH or not
ggplot(inc_data, aes(x=factor(W1InCarHH), y=W8DINCW, fill=factor(W1InCarHH))) +
    geom_boxplot() +
    labs(title="Income by Whether YP is living in a private HH or not", x="Private HH or not", y="Income at 25")

# W1hous12HH - Tenure
ggplot(inc_data, aes(x=W1hous12HH, y=W8DINCW, fill=W1hous12HH)) +
    geom_boxplot() +
    labs(title="Income by Tenure", x="Tenure", y="Income at 25")

# W1usevcHH - Whether anyone in household has use of motor vehicle
ggplot(inc_data, aes(x=W1usevcHH, y=W8DINCW, fill=W1usevcHH)) +
    geom_boxplot() +
    labs(title="Income by use of motor vehicle", x="Use of motor vehicle", y="Income at 25")

# W1hiqualmum - Mother's Education Level
ggplot(inc_data, aes(x=W1hiqualmum, y=W8DINCW, fill=W1hiqualmum)) +
    geom_boxplot() +
    labs(title="Income by Mother's Education", x="Mother's Education", y="Income at 25")

# W1hiqualdad - Father's Education Level
ggplot(inc_data, aes(x=W1hiqualdad, y=W8DINCW, fill=W1hiqualdad)) +
    geom_boxplot() +
    labs(title="Income by Father's Education", x="Father's Education", y="Income at 25")

# W1wrkfulldad - Father's Work Status
ggplot(inc_data, aes(x=W1wrkfulldad, y=W8DINCW, fill=W1wrkfulldad)) +
    geom_boxplot() +
    labs(title="Income by Father's Work Status", x="Father's Work", y="Income at 25")

# W1wrkfullmum - Mother's Work Status
ggplot(inc_data, aes(x=W1wrkfullmum, y=W8DINCW, fill=W1wrkfullmum)) +
    geom_boxplot() +
    labs(title="Income by Mother's Work Status", x="Mother's Work", y="Income at 25")

# W1empsmum - Mother's Employment
ggplot(inc_data, aes(x=W1empsmum, y=W8DINCW, fill=W1empsmum)) +
    geom_boxplot() +
    labs(title="Income by Mother's Employment", x="Mother's Employment", y="Income at 25")

# W1empsdad - Father's Employment
ggplot(inc_data, aes(x=W1empsdad, y=W8DINCW, fill=W1empsdad)) +
    geom_boxplot() +
    labs(title="Income by Father's Employment", x="Father's Employment", y="Income at 25")

# W1ch0_2HH - Number of children in house (0-2 years)
ggplot(inc_data, aes(x=W1ch0_2HH, y=W8DINCW, fill=W1ch0_2HH)) +
    geom_boxplot() +
    labs(title="Income by Presence of Children (0-2 years)", x="Children 0-2", y="Income at 25")

# W1ch3_11HH - Number of children in house (3-11 years)
ggplot(inc_data, aes(x=W1ch3_11HH, y=W8DINCW, fill=W1ch3_11HH)) +
    geom_boxplot() +
    labs(title="Income by Presence of Children (3-11 years)", x="Children 3-11", y="Income at 25")

# W1ch12_15HH - Number of children in house (12-15 years)
ggplot(inc_data, aes(x=W1ch12_15HH, y=W8DINCW, fill=W1ch12_15HH)) +
    geom_boxplot() +
    labs(title="Income by Presence of Children (12-15 years)", x="Children 12-15", y="Income at 25")

# W1ch16_17HH - Number of children in house (16-17 years)
ggplot(inc_data, aes(x=W1ch16_17HH, y=W8DINCW, fill=W1ch16_17HH)) +
    geom_boxplot() +
    labs(title="Income by Presence of Children (16-17 years)", x="Children 16-17", y="Income at 25")

# IndSchool - Attended Independent School
ggplot(inc_data, aes(x=IndSchool, y=W8DINCW, fill=IndSchool)) +
    geom_boxplot() +
    labs(title="Income by Attending Independent School", x="Independent School", y="Income at 25")

# W1marstatmum - Mother's Marital Status
ggplot(inc_data, aes(x=W1marstatmum, y=W8DINCW, fill=W1marstatmum)) +
    geom_boxplot() +
    labs(title="Income by Mother's Marital Status", x="Mother's Marital Status", y="Income at 25")

# W1depkids - Number of Dependent Kids
ggplot(inc_data, aes(x=W1depkids, y=W8DINCW, fill=W1depkids)) +
    geom_boxplot() +
    labs(title="Income by Number of Dependent Kids", x="Number of Kids", y="Income at 25")

# W1famtyp2 - Whether single parent HH
ggplot(inc_data, aes(x=W1famtyp2, y=W8DINCW, fill=W1famtyp2)) +
    geom_boxplot() +
    labs(title="Income by Whether single parent HH", x="Single parent HH", y="Income at 25")

# W1ethgrpYP - Ethnicity of YP
ggplot(inc_data, aes(x=W1ethgrpYP, y=W8DINCW, fill=W1ethgrpYP)) +
    geom_boxplot() +
    labs(title="Income by Ethnicity of YP", x="Ethnicity", y="Income at 25")

# W1nssecfam - Family’s NS-SEC class
ggplot(inc_data, aes(x=W1nssecfam, y=W8DINCW, fill=W1nssecfam)) +
    geom_boxplot() +
    labs(title="Income by Family’s NS-SEC class", x="NS-SEC class", y="Income at 25")

# W1heposs9YP - Likelihood of YP going to university
ggplot(inc_data, aes(x=W1heposs9YP, y=W8DINCW, fill=W1heposs9YP)) +
    geom_boxplot() +
    labs(title="Income by Likelihood of YP going to university", x="Likelihood of going to uni", y="Income at 25")

# W1hwndayYP - Number of evenings of HWK per week
ggplot(inc_data, aes(x=W1hwndayYP, y=W8DINCW, fill=W1hwndayYP)) +
    geom_boxplot() +
    labs(title="Income by Number of evenings of HWK per week", x="Homework evenings", y="Income at 25")

# W1truantYP - Whether YP played truant in last 12 months
ggplot(inc_data, aes(x=W1truantYP, y=W8DINCW, fill=W1truantYP)) +
    geom_boxplot() +
    labs(title="Income by Whether YP played truant in last 12 months", x="Truancy", y="Income at 25")

# W1alceverYP - Whether YP ever had alcohol
ggplot(inc_data, aes(x=W1alceverYP, y=W8DINCW, fill=W1alceverYP)) +
    geom_boxplot() +
    labs(title="Income by Whether YP ever had alcohol", x="Alcohol Use", y="Income at 25")

# W1bulrc - Bullying Experience in last 12 months
ggplot(inc_data, aes(x=W1bulrc, y=W8DINCW, fill=W1bulrc)) +
    geom_boxplot() +
    labs(title="Income by Bullying Experience in last 12 months", x="Bullying", y="Income at 25")

# W1disabYP - Disability Status Whether YP has any disability/long term illness or health problem
ggplot(inc_data, aes(x=W1disabYP, y=W8DINCW, fill=W1disabYP)) +
    geom_boxplot() +
    labs(title="Income by Disability Status", x="Disability", y="Income at 25")

# W2disc1YP - Discrimination Experience
ggplot(inc_data, aes(x=W2disc1YP, y=W8DINCW, fill=W2disc1YP)) +
    geom_boxplot() +
    labs(title="Income by Discrimination Experience", x="Discrimination", y="Income at 25")

# W2depressYP - Depression Status
ggplot(inc_data, aes(x=W2depressYP, y=W8DINCW, fill=W2depressYP)) +
    geom_boxplot() +
    labs(title="Income by Depression Status", x="Depression", y="Income at 25")

# W4AlcFreqYP - Alcohol Frequency in last 12 months
ggplot(inc_data, aes(x=W4AlcFreqYP, y=W8DINCW, fill=W4AlcFreqYP)) +
    geom_boxplot() +
    labs(title="Income by Alcohol Frequency in last 12 months", x="Alcohol Frequency", y="Income at 25")

# W4CannTryYP - Tried Cannabis
ggplot(inc_data, aes(x=W4CannTryYP, y=W8DINCW, fill=W4CannTryYP)) +
    geom_boxplot() +
    labs(title="Income by Cannabis Use", x="Tried Cannabis", y="Income at 25")

# W4NamesYP - Name Calling (Bullying)
ggplot(inc_data, aes(x=W4NamesYP, y=W8DINCW, fill=W4NamesYP)) +
    geom_boxplot() +
    labs(title="Income by Name Calling", x="Name Calling", y="Income at 25")

# W4RacismYP - Experience of Racism
ggplot(inc_data, aes(x=W4RacismYP, y=W8DINCW, fill=W4RacismYP)) +
    geom_boxplot() +
    labs(title="Income by Experience of Racism", x="Racism Experience", y="Income at 25")

# W4empsYP - Employment Status of YP
ggplot(inc_data, aes(x=W4empsYP, y=W8DINCW, fill=W4empsYP)) +
    geom_boxplot() +
    labs(title="Income by Employment Status of YP", x="Employment of YP", y="Income at 25")

# W4Childck1YP -  if YP has child
ggplot(inc_data, aes(x=W4Childck1YP, y=W8DINCW, fill=W4Childck1YP)) +
    geom_boxplot() +
    labs(title="Income by if YP has child", x="Child  Responsibility", y="Income at 25")

# W5JobYP -  currently doing paid work
ggplot(inc_data, aes(x=W5JobYP, y=W8DINCW, fill=W5JobYP)) +
    geom_boxplot() +
    labs(title="Income by whether currently doing paid work", x="Job", y="Income at 25")

# W5EducYP -  currently going to school or college
ggplot(inc_data, aes(x=W5EducYP, y=W8DINCW, fill=W5EducYP)) +
    geom_boxplot() +
    labs(title="Income by currently going to school or college", x="Education", y="Income at 25")

# W5Apprent1YP -  Whether currently doing an apprenticeship
ggplot(inc_data, aes(x=W5Apprent1YP, y=W8DINCW, fill=W5Apprent1YP)) +
    geom_boxplot() +
    labs(title="Income by Apprenticeship", x="Apprenticeship", y="Income at 25")

# W6UnivYP - Whether currently at university
ggplot(inc_data, aes(x=W6UnivYP, y=W8DINCW, fill=W6UnivYP)) +
    geom_boxplot() +
    labs(title="Income by Whether currently at university", x="University Attendance", y="Income at 25")

# W6JobYP - Whether currently doing paid work
ggplot(inc_data, aes(x=W6JobYP, y=W8DINCW, fill=W6JobYP)) +
    geom_boxplot() +
    labs(title="Income by Job Status", x="Job Status", y="Income at 25")

# W6EducYP - Whether currently going to school or college
ggplot(inc_data, aes(x=W6EducYP, y=W8DINCW, fill=W6EducYP)) +
    geom_boxplot() +
    labs(title="Income by Whether currently going to school or college", x="at school or college", y="Income at 25")

# W6acqno - Highest academic qualification studied at Wave 6
ggplot(inc_data, aes(x=W6acqno, y=W8DINCW, fill=W6acqno)) +
    geom_boxplot() +
    labs(title="Income by Academic Achievement", x="Academic Achievement", y="Income at 25")

# W6gcse - Number of GCSEs studied at Wave 6
ggplot(inc_data, aes(x=W6gcse, y=W8DINCW, fill=W6gcse)) +
    geom_boxplot() +
    labs(title="Income by GCSE Qualifications", x="GCSE Qualifications", y="Income at 25")

# W6als - Number of A/A2/AS levels being studied at Wave 6
ggplot(inc_data, aes(x=W6als, y=W8DINCW, fill=W6als)) +
    geom_boxplot() +
    labs(title="Income by Number of A/A2/AS levels being studied at Wave 6", x="A/A2/AS levels studied", y="Income at 25")

# W6OwnchiDV - Owns Children
ggplot(inc_data, aes(x=W6OwnchiDV, y=W8DINCW, fill=W6OwnchiDV)) +
    geom_boxplot() +
    labs(title="Income by Child Ownership", x="Owns Children", y="Income at 25")

# W6NEETAct - Activities of NEETs (Not in Employment or Education)
ggplot(inc_data, aes(x=W6NEETAct, y=W8DINCW, fill=W6NEETAct)) +
    geom_boxplot() +
    labs(title="Income by NEET Status", x="NEET Activity", y="Income at 25")

# W8DMARSTAT - Marital Status
ggplot(inc_data, aes(x=W8DMARSTAT, y=W8DINCW, fill=W8DMARSTAT)) +
    geom_boxplot() +
    labs(title="Income by Marital Status", x="Marital Status", y="Income at 25")

# W8TENURE -  Tenure
ggplot(inc_data, aes(x=W8TENURE, y=W8DINCW, fill=W8TENURE)) +
    geom_boxplot() +
    labs(title="Income by  Tenure", x=" Tenure", y="Income at 25")

# W8DACTIVITYC - Current activity of CM
ggplot(inc_data, aes(x=W8DACTIVITYC, y=W8DINCW, fill=W8DACTIVITYC)) +
    geom_boxplot() +
    labs(title="Income by Current activity of CM", x="Current activity", y="Income at 25")

# W8CMSEX - Gender
ggplot(inc_data, aes(x=W8CMSEX, y=W8DINCW, fill=W8CMSEX)) +
    geom_boxplot() +
    labs(title="Income by Gender", x="Gender", y="Income at 25")

# W8QMAFI - How managing financially these days
ggplot(inc_data, aes(x=W8QMAFI, y=W8DINCW, fill=W8QMAFI)) +
    geom_boxplot() +
    labs(title="Income by Financial Situation", x="Financial Situation", y="Income at 25")

# W8DWRK - Work Status
ggplot(inc_data, aes(x=W8DWRK, y=W8DINCW, fill=W8DWRK)) +
    geom_boxplot() +
    labs(title="Income by Work Status", x="Work Status", y="Income at 25")

# W8DACTIVITY - Current activity
ggplot(inc_data, aes(x=W8DACTIVITY, y=W8DINCW, fill=W8DACTIVITY)) +
    geom_boxplot() +
    labs(title="Income by Current activity", x="Current activity", y="Income at 25")

```


###Scatterplots for continuous

```{r}
ggplot(inc_data, aes(x=W1GrssyrMP, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Parental Gross Income", x="Parental Income", y="Income at 25")

ggplot(inc_data, aes(x=W1GrssyrHH, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Household Gross Income", x="Household Income", y="Income at 25")

ggplot(inc_data, aes(x=W1yschat1, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Young person's attitude to school", x="Young person's attitude to school", y="Income at 25")

ggplot(inc_data, aes(x=W2ghq12scr, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Young person GHQ12 score", x="Young person GHQ12 score", y="Income at 25")

ggplot(inc_data, aes(x=W4schatYP, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Young person's attitude to school", x="Young person's attitude to school ", y="Income at 25")

ggplot(inc_data, aes(x=W8DGHQSC, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Mental Health Score", x="GHQ-12 Score", y="Income at 25")

ggplot(inc_data, aes(x=W8QDEB2, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Total amount owe", x="Total amount owe", y="Income at 25")

ggplot(inc_data, aes(x=W6DebtattYP, y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Income vs Attitude to Debt", x="Attitude to Debt", y="Income at 25")


```


Plots for continous variables that have factor levels:
```{r}
ggplot(inc_data, aes(x = factor(W1yschat1), y = W8DINCW)) +
  geom_boxplot() +
  labs(x = "Attitude to school", y = "Income at 25")

ggplot(inc_data, aes(x = factor(W2ghq12scr), y = W8DINCW)) +
  geom_boxplot() +
  labs(x = "GHQ12 Score", y = "Income at 25")

ggplot(inc_data, aes(x = factor(W4schatYP), y = W8DINCW)) +
  geom_boxplot() +
  labs(x = "WYP attitude to school W4", y = "Income at 25")

ggplot(inc_data, aes(x = factor(W6DebtattYP), y = W8DINCW)) +
  geom_boxplot() +
  labs(x = "W6 YP attitude to debt", y = "Income at 25")

ggplot(inc_data, aes(x = factor(W8DGHQSC), y = W8DINCW)) +
  geom_boxplot() +
  labs(x = "W8 GHQ12 Score", y = "Income at 25")

```



Transformation - Log scatterplots where the 
```{r}
ggplot(inc_data, aes(x=log(W1GrssyrMP), y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Log Income vs Parental Gross Income", 
         x="Log Parental Income", y="Income at 25")

ggplot(inc_data, aes(x=log(W1GrssyrHH), y=W8DINCW)) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Log Income vs Household Gross Income", 
         x="Log Household Income", y="Income at 25")

ggplot(inc_data, aes(x=log(W8QDEB2), y=log(W8DINCW))) +
    geom_point(alpha=0.5) +
    geom_smooth(method="lm", se=FALSE, color="red") +
    labs(title="Log Income vs Log Total amount owed", 
         x="Log Total amount owed", y="Log Income at 25")
```


```{r}
# Identify negative values and NAs as missing
missing_values <- inc_data %>%
  summarise(across(everything(), ~ mean(. %in% c("-999", "-998", "-995", "-992", "-99", "-98", "-97", "-96", "-94", "-92", "-91", "-9", "-8", "-3", "-1", NA)) * 100))

# View missingness percentages
print(missing_values)

```



Creating binary variable for W6NEETAct for interpretability due to high missing
```{r}
# inc_data$W6is_NEET <- ifelse(inc_data$W6NEETAct %in% c(1, 2, 3), 0, 1)
# inc_data$W6is_NEET <- factor(inc_data$W6is_NEET, levels = c(0, 1), labels = c("NEET", "not NEET"))
# inc_data$W6is_NEET <- relevel(inc_data$W6is_NEET, ref = "not NEET")
# 
# ggplot(inc_data, aes(x = W6is_NEET, y = W8DINCW)) +
#   geom_boxplot() +
#   labs(
#     title = "Income at 25 by NEET Status at Wave 6",
#     x = "NEET Status",
#     y = "Income at 25"
#   )
```


Creating binary variable for W4Childck1YP for interpretability due to high missing
```{r}
# summary(inc_data$W4Childck1YP)
# # Drop the 37 rows with -99 (missing)
# inc_data <- inc_data[inc_data$W4Childck1YP != -99, ]
# 
# # Create binary factor variable: has_child
# inc_data$W4has_child <- factor(ifelse(inc_data$W4Childck1YP == 1, "Yes", "No"))
# inc_data$W4has_child <- relevel(inc_data$W4has_child, ref = "No")
# 
# ggplot(inc_data, aes(x = W4has_child, y = W8DINCW)) +
#   geom_boxplot() +
#   labs(
#     title = "Income at 25 by Parental Status at Wave 4",
#     x = "Had a Child by Wave 4?",
#     y = "Weekly Income at 25"
#   )
```


Turn GHQ12 score into categorical variable for better interpretation:
Decided against this afterwards, as it added more parameters to the model and wasnt significant

```{r}
# # Ensure GHQ score is numeric
# inc_data$W2ghq12scr <- as.numeric(as.character(inc_data$W2ghq12scr))
# 
# # Recode GHQ-12 into distress levels
# inc_data <- inc_data %>%
#   mutate(GHQ_bin = case_when(
#     W2ghq12scr == 0 ~ "No distress",
#     W2ghq12scr >= 1 & W2ghq12scr <= 3 ~ "Mild distress",
#     W2ghq12scr >= 4 ~ "High distress"
#   )) %>%
#   mutate(GHQ_bin = factor(GHQ_bin, levels = c("No distress", "Mild distress", "High distress")))
# inc_data$GHQ_bin <- relevel(inc_data$GHQ_bin, ref = "No distress")
# summary(inc_data$GHQ_bin)
```


```{r}
# check <- lm(W8DINCW ~ W8CMSEX + W1depkids + W1NoldBroHS +W1ch3_11HH  + W1ch12_15HH + W5EducYP +W1famtyp2 + W1hiqualmum, data=inc_data )
# summary(check)
# vif(check)
```


Turn W1GrassyHH into a categorical variable for better interpretation
```{r}
inc_data$hh_income_quintile <- cut(
  inc_data$W1GrssyrHH,
  breaks = c(-Inf, 13057, 19204, 29939, 49400, Inf),
  labels = c("Bottom Quintile (<£13,057)",
             "4th Quintile (£13,057–£19,204)",
             "3rd Quintile (£19,204–£29,939)",
             "2nd Quintile (£29,939–£49,400)",
             "Top Quintile (≥£49,400)"),
  right = FALSE  # Left inclusive but right exclusive so [low, high)
)
summary(inc_data$hh_income_quintile)
inc_data$hh_income_quintile <- relevel(inc_data$hh_income_quintile, ref = "2nd Quintile (£29,939–£49,400)")


ggplot(inc_data, aes(x = hh_income_quintile, y = W8DINCW)) +
  geom_boxplot(fill = "lightblue", color = "black", outlier.alpha = 0.3) +
  labs(
    title = "Income at Age 25 by Household Income Quintile",
    x = "Household Income Quintile",
    y = "Income at 25"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Add a "Missing" level for NAs
inc_data$hh_income_quintile <- as.character(inc_data$hh_income_quintile)
inc_data$hh_income_quintile[is.na(inc_data$hh_income_quintile)] <- "Missing"
inc_data$hh_income_quintile <- factor(inc_data$hh_income_quintile)

```


Merge levels to reduce model parameters.
Turn Missing into a level.
Set baselines to the most populated category.

```{r}
# W1wrk1aMP - Work status
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("1", "3")] <- "Full time"
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("2", "4")] <- "Part time"
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("5")] <- "Unemployed"
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("10")] <- "Looking after home/ family"
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("6", "7", "8", "9", "11","12")] <- "Economically_inactive/Other"
levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("-91", "-99")] <- "Missing"
inc_data$W1wrk1aMP <- relevel(inc_data$W1wrk1aMP, ref="Full time")
summary(inc_data$W1wrk1aMP)

# W1condur5MP - Do they own a computer in household
levels(inc_data$W1condur5MP)[levels(inc_data$W1condur5MP) %in% c("1")] <- "Yes"
levels(inc_data$W1condur5MP)[levels(inc_data$W1condur5MP) %in% c("2")] <- "No"
levels(inc_data$W1condur5MP)[levels(inc_data$W1condur5MP) %in% c("-91", "-99", "-1")] <- "Missing"
inc_data$W1condur5MP <- relevel(inc_data$W1condur5MP, ref="Yes")
summary(inc_data$W1condur5MP)

# W1hea2MP - Long-term illness/disability
levels(inc_data$W1hea2MP)[levels(inc_data$W1hea2MP) %in% c("1")] <- "Yes"
levels(inc_data$W1hea2MP)[levels(inc_data$W1hea2MP) %in% c("2")] <- "No"
levels(inc_data$W1hea2MP)[levels(inc_data$W1hea2MP) %in% c("-91", "-99", "-1", "-92")] <- "Missing"
inc_data$W1hea2MP <- relevel(inc_data$W1hea2MP, ref="No")
summary(inc_data$W1hea2MP)

# W1InCarHH - Private household
levels(inc_data$W1InCarHH)[levels(inc_data$W1InCarHH) %in% c("1")] <- "Private household"
levels(inc_data$W1InCarHH)[levels(inc_data$W1InCarHH) %in% c("2", "3", "4")] <- "Not private household"
levels(inc_data$W1InCarHH)[levels(inc_data$W1InCarHH) %in% c("-999")] <- "Missing"
inc_data$W1InCarHH <- relevel(inc_data$W1InCarHH, ref="Private household")
summary(inc_data$W1InCarHH)

# W1NoldBroHS - If they have younger siblings
levels(inc_data$W1NoldBroHS)[levels(inc_data$W1NoldBroHS) %in% c("0")] <- "No younger siblings"
levels(inc_data$W1NoldBroHS)[levels(inc_data$W1NoldBroHS) %in% c("1")] <- "1 younger sibling"
levels(inc_data$W1NoldBroHS)[levels(inc_data$W1NoldBroHS) %in% c("2")] <- "2 younger sibling"
levels(inc_data$W1NoldBroHS)[levels(inc_data$W1NoldBroHS) %in% c("3", "4", "5", "6", "7", "9", "12")] <- "3+ younger siblings"
levels(inc_data$W1NoldBroHS)[levels(inc_data$W1NoldBroHS) %in% c("-97", "-99", "-92", "-995")] <- "Missing"
inc_data$W1NoldBroHS <- relevel(inc_data$W1NoldBroHS, ref="No younger siblings")
summary(inc_data$W1NoldBroHS)

# W1usevcHH - Household uses motor vehicle
levels(inc_data$W1usevcHH)[levels(inc_data$W1usevcHH) %in% c("1")] <- "Yes"
levels(inc_data$W1usevcHH)[levels(inc_data$W1usevcHH) %in% c("2")] <- "No"
levels(inc_data$W1usevcHH)[levels(inc_data$W1usevcHH) %in% c("-91", "-1", "-92")] <- "Missing"
inc_data$W1usevcHH <- relevel(inc_data$W1usevcHH, ref="Yes")
summary(inc_data$W1usevcHH)

# W1hiqualmum - Highest qualification of mother
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("1", "2")] <- "Degree"
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("3", "4", "5", "6")] <- "Higher education (pre degree)"
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("7", "8", "9", "10", "11", "12", "13")] <- "Further education (16-18)"
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("14", "15", "16", "17", "18", "19")] <- "General secondary education (14-16)"
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("20")] <- "No qualification"
levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("-999", "-99", "-94", "-98")] <- "Missing"
#levels(inc_data$W1hiqualmum)[levels(inc_data$W1hiqualmum) %in% c("-98")] <- "Mother not present"
inc_data$W1hiqualmum <- relevel(inc_data$W1hiqualmum, ref="General secondary education (14-16)")
summary(inc_data$W1hiqualmum)

# W1hiqualdad - Highest qualification of father
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("1", "2")] <- "Degree"
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("3", "4", "5", "6")] <- "Higher education (pre degree)"
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("7", "8", "9", "10", "11", "12", "13")] <- "Further education (16-18)"
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("14", "15", "16", "17", "18", "19")] <- "General secondary education (14-16)"
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("20")] <- "No qualification"
#levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("-98")] <- "Father not present"
levels(inc_data$W1hiqualdad)[levels(inc_data$W1hiqualdad) %in% c("-999", "-99", "-94" , "-98")] <- "Missing"
inc_data$W1hiqualdad <- relevel(inc_data$W1hiqualdad, ref="Further education (16-18)")
summary(inc_data$W1hiqualdad)

# W1ch0_2HH - Number of children aged 0-2 in household  
levels(inc_data$W1ch0_2HH)[levels(inc_data$W1ch0_2HH) %in% c("1","2", "3")] <- "1-3 child"
levels(inc_data$W1ch0_2HH)[levels(inc_data$W1ch0_2HH) %in% c("-999", "-94")] <- "Missing"
inc_data$W1ch0_2HH <- relevel(inc_data$W1ch0_2HH, ref="0")
summary(inc_data$W1ch0_2HH)

# W1ch3_11HH - Number of children aged 3-11 in household  
levels(inc_data$W1ch3_11HH)[levels(inc_data$W1ch3_11HH) %in% c("3", "4", "5")] <- "3-5 child"
levels(inc_data$W1ch3_11HH)[levels(inc_data$W1ch3_11HH) %in% c("-999", "-94")] <- "Missing"
inc_data$W1ch3_11HH <- relevel(inc_data$W1ch3_11HH, ref="0")
summary(inc_data$W1ch3_11HH)

# W1ch12_15HH - Number of children aged 12-15 in household  
levels(inc_data$W1ch12_15HH)[levels(inc_data$W1ch12_15HH) %in% c("0", "1")] <- "0-1 child"
levels(inc_data$W1ch12_15HH)[levels(inc_data$W1ch12_15HH) %in% c("3", "4")] <- "3-4 child"
levels(inc_data$W1ch12_15HH)[levels(inc_data$W1ch12_15HH) %in% c("-999", "-94")] <- "Missing"
inc_data$W1ch12_15HH <- relevel(inc_data$W1ch12_15HH, ref="0-1 child")
summary(inc_data$W1ch12_15HH)

# W1ch16_17HH - Number of children aged 16-17 in household  
levels(inc_data$W1ch16_17HH)[levels(inc_data$W1ch16_17HH) %in% c("2", "3")] <- "2-3 children"
levels(inc_data$W1ch16_17HH)[levels(inc_data$W1ch16_17HH) %in% c("-999", "-94")] <- "Missing"
inc_data$W1ch16_17HH <- relevel(inc_data$W1ch16_17HH, ref="0")
summary(inc_data$W1ch16_17HH)

# W1marstatmum - mothers martial status
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("1")] <- "Single"
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("2")] <- "Married"
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("3")] <- "Cohabiting"
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("4", "5","6","7")] <- "Separated/divorced/Widowed/Other"
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("-98")] <- "Mother not present"
levels(inc_data$W1marstatmum)[levels(inc_data$W1marstatmum) %in% c("-999", "-92", "-91")] <- "Missing"
inc_data$W1marstatmum <- relevel(inc_data$W1marstatmum, ref="Married")
summary(inc_data$W1marstatmum)

# W1depkids - Number of Dependent Kids
levels(inc_data$W1depkids)[levels(inc_data$W1depkids) %in% c("4", "5", "6", "7", "8", "9", "10")] <- "4+ kids"
levels(inc_data$W1depkids)[levels(inc_data$W1depkids) %in% c("-999", "-94")] <- "Missing"
inc_data$W1depkids <- relevel(inc_data$W1depkids, ref="2")
summary(inc_data$W1depkids)

# W1nssecfam - Family’s NS-SEC class
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("1", "2")] <- "Managerial/Professional"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("3")] <- "Intermediate"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("4")] <- "Self-employed"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("5")] <- "Supervisory/technical"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("6", "7")] <- "Routine/Semi-routine"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("8")] <- "Never Worked/unemployed"
levels(inc_data$W1nssecfam)[levels(inc_data$W1nssecfam) %in% c("-99", "-94", "-91", "-999")] <- "Missing"
inc_data$W1nssecfam <- relevel(inc_data$W1nssecfam, ref="Managerial/Professional")
summary(inc_data$W1nssecfam)

# W1ethgrpYP - Ethnicity of YP
levels(inc_data$W1ethgrpYP)[levels(inc_data$W1ethgrpYP) %in% c("1")] <- "White"
levels(inc_data$W1ethgrpYP)[levels(inc_data$W1ethgrpYP) %in% c("2", "8")] <- "Other/Mixed"
levels(inc_data$W1ethgrpYP)[levels(inc_data$W1ethgrpYP) %in% c("3", "4", "5")] <- "South Asian"
levels(inc_data$W1ethgrpYP)[levels(inc_data$W1ethgrpYP) %in% c("6", "7")] <- "Black - African/Caribbean"
levels(inc_data$W1ethgrpYP)[levels(inc_data$W1ethgrpYP) %in% c("-999", "-92")] <- "Missing"
inc_data$W1ethgrpYP <- relevel(inc_data$W1ethgrpYP, ref="White")
summary(inc_data$W1ethgrpYP)

# W1heposs9YP - Likelihood of YP going to university
# levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("1", "2")] <- "Likely"
# levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("3", "4")] <- "Not likely"
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("-1")] <- "Don't know"
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("-99")] <- "Missing"
inc_data$W1heposs9YP <- relevel(inc_data$W1heposs9YP, ref="1")
summary(inc_data$W1heposs9YP)

# W1hwndayYP - Number of evenings of HWK per week
levels(inc_data$W1hwndayYP)[levels(inc_data$W1hwndayYP) %in% c("0", "1")] <- "0-1 evenings"
# levels(inc_data$W1hwndayYP)[levels(inc_data$W1hwndayYP) %in% c("2", "3")] <- "2-3 evenings"
# levels(inc_data$W1hwndayYP)[levels(inc_data$W1hwndayYP) %in% c("4", "5")] <- "4-5 evenings"
levels(inc_data$W1hwndayYP)[levels(inc_data$W1hwndayYP) %in% c("-91", "-998", "-99", "-1")] <- "Missing"
inc_data$W1hwndayYP <- relevel(inc_data$W1hwndayYP, ref="3")
summary(inc_data$W1hwndayYP)

# W1truantYP - Whether YP played truant in last 12 months
levels(inc_data$W1truantYP)[levels(inc_data$W1truantYP) %in% c("1")] <- "Yes"
levels(inc_data$W1truantYP)[levels(inc_data$W1truantYP) %in% c("2")] <- "No"
levels(inc_data$W1truantYP)[levels(inc_data$W1truantYP) %in% c("-97", "-96", "-92", "-1", "-99")] <- "Missing"
inc_data$W1truantYP <- relevel(inc_data$W1truantYP, ref="No")
summary(inc_data$W1truantYP)

# W1alceverYP - Whether YP ever had alcohol
levels(inc_data$W1alceverYP)[levels(inc_data$W1alceverYP) %in% c("1")] <- "Yes"
levels(inc_data$W1alceverYP)[levels(inc_data$W1alceverYP) %in% c("2")] <- "No"
levels(inc_data$W1alceverYP)[levels(inc_data$W1alceverYP) %in% c("-97", "-96", "-92", "-1", "-99")] <- "Missing"
inc_data$W1alceverYP <- relevel(inc_data$W1alceverYP, ref="No")
summary(inc_data$W1alceverYP)

# W1bulrc - Bullying Experience in last 12 months
levels(inc_data$W1bulrc)[levels(inc_data$W1bulrc) %in% c("1")] <- "Yes"
levels(inc_data$W1bulrc)[levels(inc_data$W1bulrc) %in% c("2")] <- "No"
levels(inc_data$W1bulrc)[levels(inc_data$W1bulrc) %in% c("-97", "-96", "-92", "-1", "-99")] <- "Missing"
inc_data$W1bulrc <- relevel(inc_data$W1bulrc, ref="No")
summary(inc_data$W1bulrc)

# W1disabYP - Disability Status Whether YP has any disability/long term illness or health problem
levels(inc_data$W1disabYP)[levels(inc_data$W1disabYP) %in% c("1")] <- "Has disability, schooling affected"
levels(inc_data$W1disabYP)[levels(inc_data$W1disabYP) %in% c("2")] <- "Has disability, schooling not affected"
levels(inc_data$W1disabYP)[levels(inc_data$W1disabYP) %in% c("3")] <- " No disabilty"
levels(inc_data$W1disabYP)[levels(inc_data$W1disabYP) %in% c("-97", "-94", "-1", "-99")] <- "Missing"
inc_data$W1disabYP <- relevel(inc_data$W1disabYP, ref=" No disabilty")
summary(inc_data$W1disabYP)

# W2disc1YP - Discrimination Experience
levels(inc_data$W2disc1YP)[levels(inc_data$W2disc1YP) %in% c("1")] <- "Yes"
levels(inc_data$W2disc1YP)[levels(inc_data$W2disc1YP) %in% c("2")] <- "No"
levels(inc_data$W2disc1YP)[levels(inc_data$W2disc1YP) %in% c("-99", "-97", "-96", "-92", "-1")] <- "Missing"
inc_data$W2disc1YP <- relevel(inc_data$W2disc1YP, ref="No")
summary(inc_data$W2disc1YP)

# W2depressYP - Depression Status
levels(inc_data$W2depressYP)[levels(inc_data$W2depressYP) %in% c("1")] <- "Not at all"
levels(inc_data$W2depressYP)[levels(inc_data$W2depressYP) %in% c("2")] <- "No more than usual"
levels(inc_data$W2depressYP)[levels(inc_data$W2depressYP) %in% c("3")] <- "Rather more than usual"
levels(inc_data$W2depressYP)[levels(inc_data$W2depressYP) %in% c("4")] <- "Much more than usual"
levels(inc_data$W2depressYP)[levels(inc_data$W2depressYP) %in% c("-99", "-97", "-96", "-92", "-1")] <- "Missing"
inc_data$W2depressYP <- relevel(inc_data$W2depressYP, ref="Not at all")
summary(inc_data$W2depressYP)

# W4AlcFreqYP - Alcohol Frequency in last 12 months
levels(inc_data$W4AlcFreqYP)[levels(inc_data$W4AlcFreqYP) %in% c("1", "2")] <- "Weekly"
levels(inc_data$W4AlcFreqYP)[levels(inc_data$W4AlcFreqYP) %in% c("3", "4")] <- "Monthly"
levels(inc_data$W4AlcFreqYP)[levels(inc_data$W4AlcFreqYP) %in% c("5", "6")] <- "Yearly"
inc_data$W4AlcFreqYP <- relevel(inc_data$W4AlcFreqYP, ref="Weekly")
levels(inc_data$W4AlcFreqYP)[levels(inc_data$W4AlcFreqYP) %in% c("-91", "-99", "-97", "-96", "-92", "-1")] <- "Missing"
summary(inc_data$W4AlcFreqYP)

# W4CannTryYP - Tried Cannabis
levels(inc_data$W4CannTryYP)[levels(inc_data$W4CannTryYP) %in% c("1")] <- "Yes"
levels(inc_data$W4CannTryYP)[levels(inc_data$W4CannTryYP) %in% c("2")] <- "No"
levels(inc_data$W4CannTryYP)[levels(inc_data$W4CannTryYP) %in% c("-91", "-99", "-97", "-96", "-92", "-1")] <- "Missing"
inc_data$W4CannTryYP <- relevel(inc_data$W4CannTryYP, ref="No")
summary(inc_data$W4CannTryYP)

# W4NamesYP - Name Calling (Bullying)
levels(inc_data$W4NamesYP)[levels(inc_data$W4NamesYP) %in% c("1")] <- "Yes"
levels(inc_data$W4NamesYP)[levels(inc_data$W4NamesYP) %in% c("2")] <- "No"
levels(inc_data$W4NamesYP)[levels(inc_data$W4NamesYP) %in% c("-91", "-99", "-97", "-96", "-92", "-1")] <- "Missing"
inc_data$W4NamesYP <- relevel(inc_data$W4NamesYP, ref="No")
summary(inc_data$W4NamesYP)

# W4RacismYP - Experience of Racism
levels(inc_data$W4RacismYP)[levels(inc_data$W4RacismYP) %in% c("1")] <- "Yes"
levels(inc_data$W4RacismYP)[levels(inc_data$W4RacismYP) %in% c("2")] <- "No"
levels(inc_data$W4RacismYP)[levels(inc_data$W4RacismYP) %in% c("-91", "-99", "-97", "-96", "-92", "-1")] <- "Missing"
inc_data$W4RacismYP <- relevel(inc_data$W4RacismYP, ref="No")
summary(inc_data$W4RacismYP)

# W4empsYP - Employment Status of YP
levels(inc_data$W4empsYP)[levels(inc_data$W4empsYP) %in% c("1")] <- "Employed - full time"
levels(inc_data$W4empsYP)[levels(inc_data$W4empsYP) %in% c("2")] <- "Employed - part time"
levels(inc_data$W4empsYP)[levels(inc_data$W4empsYP) %in% c("3", "4", "5", "6", "8","9")] <- "Unemployed"
inc_data$W4empsYP <- relevel(inc_data$W4empsYP, ref="Unemployed")
inc_data$W4empsYP <- droplevels(inc_data$W4empsYP)
summary(inc_data$W4empsYP)

# W5JobYP -  currently doing paid work
levels(inc_data$W5JobYP)[levels(inc_data$W5JobYP) %in% c("1")] <- "Yes"
levels(inc_data$W5JobYP)[levels(inc_data$W5JobYP) %in% c("2")] <- "No"
levels(inc_data$W5JobYP)[levels(inc_data$W5JobYP) %in% c("-92")] <- "Missing"
inc_data$W5JobYP <- relevel(inc_data$W5JobYP, ref="Yes")
summary(inc_data$W5JobYP)

# W5EducYP -  currently going to school or college
levels(inc_data$W5EducYP)[levels(inc_data$W5EducYP) %in% c("1")] <- "Yes"
levels(inc_data$W5EducYP)[levels(inc_data$W5EducYP) %in% c("2")] <- "No"
levels(inc_data$W5EducYP)[levels(inc_data$W5EducYP) %in% c("-92")] <- "Missing"
inc_data$W5EducYP <- relevel(inc_data$W5EducYP, ref="Yes")
summary(inc_data$W5EducYP)

# W5Apprent1YP -  Whether currently doing an apprenticeship
levels(inc_data$W5Apprent1YP)[levels(inc_data$W5Apprent1YP) %in% c("1")] <- "Yes"
levels(inc_data$W5Apprent1YP)[levels(inc_data$W5Apprent1YP) %in% c("2")] <- "No"
levels(inc_data$W5Apprent1YP)[levels(inc_data$W5Apprent1YP) %in% c("-1")] <- "Missing"
inc_data$W5Apprent1YP <- relevel(inc_data$W5Apprent1YP, ref="No")
summary(inc_data$W5Apprent1YP)

# W6UnivYP - Whether currently at university
levels(inc_data$W6UnivYP)[levels(inc_data$W6UnivYP) %in% c("1")] <- "Yes"
levels(inc_data$W6UnivYP)[levels(inc_data$W6UnivYP) %in% c("2")] <- "No"
levels(inc_data$W6UnivYP)[levels(inc_data$W6UnivYP) %in% c("-92")] <- "Missing"
inc_data$W6UnivYP <- relevel(inc_data$W6UnivYP, ref="No")
summary(inc_data$W6UnivYP)

# W6JobYP - Whether currently doing paid work
levels(inc_data$W6JobYP)[levels(inc_data$W6JobYP) %in% c("1")] <- "Yes"
levels(inc_data$W6JobYP)[levels(inc_data$W6JobYP) %in% c("2")] <- "No"
levels(inc_data$W6JobYP)[levels(inc_data$W6JobYP) %in% c("-92")] <- "Missing"
inc_data$W6JobYP <- relevel(inc_data$W6JobYP, ref="Yes")
summary(inc_data$W6JobYP)

# W6EducYP - Whether currently going to school or college
levels(inc_data$W6EducYP)[levels(inc_data$W6EducYP) %in% c("1")] <- "Yes"
levels(inc_data$W6EducYP)[levels(inc_data$W6EducYP) %in% c("2")] <- "No"
levels(inc_data$W6EducYP)[levels(inc_data$W6EducYP) %in% c("-91", "-92")] <- "Missing"
inc_data$W6EducYP <- relevel(inc_data$W6EducYP, ref="No")
summary(inc_data$W6EducYP)

# W6acqno - Highest academic qualification studied at Wave 6
levels(inc_data$W6acqno)[levels(inc_data$W6acqno) %in% c("1", "2")] <- "Degree/ HE"
levels(inc_data$W6acqno)[levels(inc_data$W6acqno) %in% c("3", "4")] <- "A/AS level"
levels(inc_data$W6acqno)[levels(inc_data$W6acqno) %in% c("5", "6")] <- "GCSE"
levels(inc_data$W6acqno)[levels(inc_data$W6acqno) %in% c("7", "8")] <- "Other/unknown"
levels(inc_data$W6acqno)[levels(inc_data$W6acqno) %in% c("9")] <- "No academic study aim"
summary(inc_data$W6acqno)
inc_data$W6acqno <- relevel(inc_data$W6acqno, ref="No academic study aim")

inc_data$W6gcse <- relevel(inc_data$W6gcse, ref="4")

inc_data$W6als <- relevel(inc_data$W6als, ref="4")

# W6OwnchiDV - Owns Children
levels(inc_data$W6OwnchiDV)[levels(inc_data$W6OwnchiDV) %in% c("1")] <- "Yes"
levels(inc_data$W6OwnchiDV)[levels(inc_data$W6OwnchiDV) %in% c("2")] <- "No"
levels(inc_data$W6OwnchiDV)[levels(inc_data$W6OwnchiDV) %in% c("-94", "-92", "-1")] <- "Missing"
inc_data$W6OwnchiDV <- relevel(inc_data$W6OwnchiDV, ref="No")
summary(inc_data$W6OwnchiDV)

# W8DMARSTAT - Marital Status
levels(inc_data$W8DMARSTAT)[levels(inc_data$W8DMARSTAT) %in% c("1")] <- "Single"
levels(inc_data$W8DMARSTAT)[levels(inc_data$W8DMARSTAT) %in% c("2", "6")] <- "Married/In civil partnership"
levels(inc_data$W8DMARSTAT)[levels(inc_data$W8DMARSTAT) %in% c("3", "4", "5", "7", "8", "9")] <- "Separated/divorced/other"
inc_data$W8DMARSTAT <- relevel(inc_data$W8DMARSTAT, ref="Single")
levels(inc_data$W8DMARSTAT)[levels(inc_data$W8DMARSTAT) %in% c("-9", "-8")] <- "Missing"
summary(inc_data$W8DMARSTAT)

# W8CMSEX - Gender
levels(inc_data$W8CMSEX)[levels(inc_data$W8CMSEX) %in% c("1")] <- "Male"
levels(inc_data$W8CMSEX)[levels(inc_data$W8CMSEX) %in% c("2")] <- "Female"
summary(inc_data$W8CMSEX)
inc_data$W8CMSEX <- relevel(inc_data$W8CMSEX, ref="Female")

# W8TENURE -  Tenure
levels(inc_data$W8TENURE)[levels(inc_data$W8TENURE) %in% c("1")] <- "Own outright"
levels(inc_data$W8TENURE)[levels(inc_data$W8TENURE) %in% c("2")] <- "Own with help of mortg/loan"
levels(inc_data$W8TENURE)[levels(inc_data$W8TENURE) %in% c("3", "4", "5")] <- "Rent"
levels(inc_data$W8TENURE)[levels(inc_data$W8TENURE) %in% c("6", "7")] <- "Other"
levels(inc_data$W8TENURE)[levels(inc_data$W8TENURE) %in% c("-9", "-8", "-1")] <- "Missing"
inc_data$W8TENURE <- relevel(inc_data$W8TENURE, ref="Rent")
summary(inc_data$W8TENURE)

# W8QMAFI - How managing financially these days
#levels(inc_data$W8QMAFI)[levels(inc_data$W8QMAFI) %in% c("1", "2")] <- "Financially secure"
#levels(inc_data$W8QMAFI)[levels(inc_data$W8QMAFI) %in% c("3", "4", "5")] <- "Financially struggling"
levels(inc_data$W8QMAFI)[levels(inc_data$W8QMAFI) %in% c("-9", "-8", "-1")] <- "Missing"
inc_data$W8QMAFI <- relevel(inc_data$W8QMAFI, ref="2")
summary(inc_data$W8QMAFI)

# W8DWRK - Work Status
levels(inc_data$W8DWRK)[levels(inc_data$W8DWRK) %in% c("1")] <- "Yes"
levels(inc_data$W8DWRK)[levels(inc_data$W8DWRK) %in% c("2")] <- "No"
levels(inc_data$W8DWRK)[levels(inc_data$W8DWRK) %in% c("-8", "-1")] <- "Missing"
inc_data$W8DWRK <- relevel(inc_data$W8DWRK, ref="Yes")

# W8DACTIVITY - Current activity
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("1", "3")] <- "Full time employment"
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("2", "4")] <- "Part time employment"
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("6", "7", "8", "12")] <- "Education/training"
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("5")] <- "Unemployed and seeking work"
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("9", "10", "11", "13", "14")] <- "Economically inactive/ other"
levels(inc_data$W8DACTIVITY)[levels(inc_data$W8DACTIVITY) %in% c("-8", "-1")] <- "Missing"
summary(inc_data$W8DACTIVITY)
inc_data$W8DACTIVITY <- relevel(inc_data$W8DACTIVITY, ref = "Full time employment")


levels(inc_data$W1famtyp2)[levels(inc_data$W1famtyp2) %in% c("-999", "-94")] <- "Missing"
inc_data$W1famtyp2 <- relevel(inc_data$W1famtyp2, ref = "0")
summary(inc_data$W1famtyp2)

```



First model: 
drop W1GrssyrMP - too many missing
drop W1GrssyrHH, using new index instead
drop -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad, aliased with w1wrk1aMP. they will be explained via income of main parent and NEC score and w1wrkMP
drop -W4Childck1YP  -W6NEETAct too many missing
drop W8Dwrk W8DACTIVITYC and W8DACTIVITY  as doesnt make sense for the question

```{r}
model_1 <- lm(W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITY , data=inc_data)
summary(model_1)
Anova(model_1)
```

```{r}
model_test <- lm(W8DINCW ~ hh_income_quintile, data = inc_data)
summary(model_test)

```

```{r}
model_2 <- lm(W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITY -W8DACTIVITYC
              
              -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1famtyp2  -W1depkids
              
               -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI , data=inc_data)
summary(model_2)
Anova(model_2)

#vif(model_2) This returns an error due to aliased coefficients in the model 
```


aliased due to NA in missing values for disabled.

```{r}
inc_data <- subset(inc_data, W1disabYP != "Missing")
inc_data$W1disabYP <- droplevels(inc_data$W1disabYP)

inc_data <- subset(inc_data, W1usevcHH != "Missing")
inc_data$W1usevcHH <- droplevels(inc_data$W1usevcHH)

model_3 <- lm(W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITY -W8DACTIVITYC
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids -W1famtyp2 
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
            
            
             , data=inc_data)
  

summary(model_3)
Anova(model_3)

vif(model_3)
```


 hiqualmum (118.0058), marstasmum (717.7403) has extremely high vif.

so remove marstasmum
 
```{r}
model_4 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITY -W8DACTIVITYC
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids -W1famtyp2 
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             
            -W1marstatmum   , data=inc_data)

summary(model_4)
Anova(model_4)

vif(model_4)
```

```{r}
model_5 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITY -W8DACTIVITYC
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids -W1famtyp2 
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
            -W1marstatmum 
            
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W4AlcFreqYP -W1hea2MP
            
            -W4empsYP -W1alceverYP
              , data=inc_data)

summary(model_5)
Anova(model_5)

vif(model_5)
```

```{r}
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("1")] <- "Very likely"
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("2")] <- "Fairly likely"
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("3")] <- "Not very likely"
levels(inc_data$W1heposs9YP)[levels(inc_data$W1heposs9YP) %in% c("4")] <- "Not at all likely"
inc_data$W1heposs9YP <- relevel(inc_data$W1heposs9YP, ref="Very likely")


summary(inc_data$W4CannTryYP)
inc_data <- subset(inc_data, W4CannTryYP != "Missing")
inc_data$W4CannTryYP <- droplevels(inc_data$W4CannTryYP)

summary(inc_data$W6OwnchiDV)
inc_data <- subset(inc_data, W6OwnchiDV != "Missing")
inc_data$W6OwnchiDV <- droplevels(inc_data$W6OwnchiDV)


summary(inc_data$W5Apprent1YP)
inc_data <- subset(inc_data, W5Apprent1YP != "Missing")
inc_data$W5Apprent1YP <- droplevels(inc_data$W5Apprent1YP)

summary(inc_data$W6JobYP)
inc_data <- subset(inc_data, W6JobYP != "Missing")
inc_data$W6JobYP <- droplevels(inc_data$W6JobYP)

summary(inc_data$W6UnivYP)
inc_data <- subset(inc_data, W6UnivYP != "Missing")
inc_data$W6UnivYP <- droplevels(inc_data$W6UnivYP)

levels(inc_data$W1famtyp2)[levels(inc_data$W1famtyp2) %in% c("0")] <- "No"
levels(inc_data$W1famtyp2)[levels(inc_data$W1famtyp2) %in% c("1")] <- "Yes"
inc_data$W1famtyp2 <- relevel(inc_data$W1famtyp2, ref="No")


levels(inc_data$W1wrk1aMP)[levels(inc_data$W1wrk1aMP) %in% c("Unemployed", "Economically_inactive/Other")] <- "Economically inactive/Unemployed/Other"
inc_data$W1wrk1aMP <- relevel(inc_data$W1wrk1aMP, ref="Full time")

summary(inc_data$W1hiqualmum)
inc_data <- subset(inc_data, W1hiqualmum != "Missing")
inc_data$W1hiqualmum <- droplevels(inc_data$W1hiqualmum)

```


```{r}
model_6 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum
            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad 
              , data=inc_data)

summary(model_6)
Anova(model_6)

vif(model_6)
```


check without hh_income_quintile because of its high missingness 

But this model 7 is worse, so we stick with model 6

```{r}
model_7 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum
            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad  
            
            -hh_income_quintile
              , data=inc_data)

summary(model_7)
Anova(model_7)

vif(model_7)
```



INTERACTIONS
W6UnivYP * W6DebtattYP
not significant 

```{r}
model_6_interact <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum
            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad 
            
            + W6UnivYP * W6DebtattYP
              , data=inc_data)

summary(model_6_interact)
Anova(model_6_interact)

vif(model_6_interact)
```


W1nssecfam with W1ethgrpYP

```{r}
model_6_interact2 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum
            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad 
            
            + W1nssecfam * W1ethgrpYP
              , data=inc_data)

summary(model_6_interact2)
Anova(model_6_interact2)

```



```{r}
AIC(model_6)

AIC(model_7)  # hh_income_quintile removed

AIC(model_6_interact)


```



```{r}
model_8 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             

            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad 
            
          
              , data=inc_data)

summary(model_8)
Anova(model_8)
vif(model_8)
```



```{r}
model_9 <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH  -W1depkids
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             

            
            -W4empsYP -W1alceverYP -W1NoldBroHS
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr -W1hiqualdad 
            
          -W1famtyp2
              , data=inc_data)

summary(model_9)
Anova(model_9)
vif(model_9)
```




```{r}
model_data <- model.frame(model_6)
table(model_data$hh_income_quintile)
```




Residuals
```{r}
plot(model_6, which = 1)  # Residuals vs Fitted
plot(model_6, which = 2)  # Q-Q plot
plot(model_6, which = 4)  # Cook's Distance
```

Outlier Analysis


```{r}
max(inc_data$W8DINCW)
```

This income is very reasoble, and so we cannot argue that there has been any mistakes for Y-values. Furthermore, there aren't many outlier points, so we'll just check if they change the regression parameters  

```{r}
# function which we'll use for our final models 
show_outliers <- function(the.linear.model, topN) {
  n = length(fitted(the.linear.model))      # number of observations
  p = length(coef(the.linear.model))        # number of parameters
  
  # Standardised residuals
  res.out <- which(abs(rstandard(the.linear.model)) > 3)
  res.top <- head(rev(sort(abs(rstandard(the.linear.model)))), topN)
  
  # Leverage
  lev.out <- which(lm.influence(the.linear.model)$hat > 2 * p/n)
  lev.top <- head(rev(sort(lm.influence(the.linear.model)$hat)), topN)
  
  # DFFITS
  dffits.out <- which(dffits(the.linear.model) > 2 * sqrt(p/n))
  dffits.top <- head(rev(sort(dffits(the.linear.model))), topN)
  
  # Cook's Distance
  cooks.out <- which(cooks.distance(the.linear.model) > 1)
  cooks.top <- head(rev(sort(cooks.distance(the.linear.model))), topN)
  
list.of.stats<-list(Std.res=res.out,Std.res.top=res.top, Leverage=lev.out, Leverage.top=lev.top, DFFITS=dffits.out, DFFITS.top=dffits.top, Cooks=cooks.out,Cooks.top=cooks.top)
#return the statistics
list.of.stats}

```

```{r}
model_6.outliers <- show_outliers(model_6, topN = 10)
model_6.outliers


all_outlier_ids <- c(
  model_6.outliers$Std.res,
  model_6.outliers$Leverage,
  model_6.outliers$DFFITS,
  model_6.outliers$Cooks
)

# Count how often each point appears
outlier_counts <- table(all_outlier_ids)

multi_violators <- as.numeric(names(outlier_counts[outlier_counts > 1]))

# Print them
cat("Points that violate more than one criterion:\n")
print(multi_violators)
```


```{r}
plot_outlier_diagnostics <- function(model) {
  old_par <- par(no.readonly = TRUE)  
  on.exit(par(old_par))              
  
  n <- nrow(model$model)
  cooks_threshold <- 4 / n
  p <- length(coef(model))
  
  par(mfrow = c(2, 2))  
  
 
  plot(model, which = 1, main = "Residuals vs Fitted")

 
  plot(model, which = 2, main = "Normal Q-Q Plot")

  
  plot(cooks.distance(model), type = "h", main = "Cook's Distance", 
       ylab = "Cook's D", xlab = "Observation Index")
  abline(h = cooks_threshold, col = "green", lty = 2)
  legend("topright", legend = paste("Threshold =", round(cooks_threshold, 3)), 
         col = "green", lty = 2, bty = "n")

  
  plot(model, which = 5, main = "Leverage vs. Standardised Residuals")
  
  
 
}
```

```{r}
plot_outlier_diagnostics(model_6)
```



```{r}

model_6_data <- model_6$model

full_no_outliers <- model_6_data[-all_outlier_ids, ]

model_6_no_outlier <- lm(W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids  
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum   -W1hiqualdad -W1NoldBroHS  -W1usevcHH
            
            -W4empsYP -W1alceverYP
            
            -W1usevcHH -W1hwndayYP -W2ghq12scr
              ,data=full_no_outliers)

summary(model_6_no_outlier)
Anova(model_6_no_outlier)
vif(model_6_no_outlier)
```

```{r}
summary(model_6_data)
```




## cross validation

Segment the dataset for cross validation
```{r}
vars_needed <- c(
  "W8DINCW", 
  "W1wrk1aMP", "W1hiqualmum", "W1famtyp2", "W1nssecfam", "W1ethgrpYP",
  "W1heposs9YP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W4schatYP",
  "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6OwnchiDV",
  "W6DebtattYP", "W8CMSEX", "hh_income_quintile"
)

```


subset and drop unused factor levels
```{r}
cv_model_data <- full_no_outliers[, vars_needed]
cv_model_data <- droplevels(cv_model_data)
```




```{r}

in.sample.mse <- rep(NA, 100)
out.sample.mse <- rep(NA, 100)

for (i in 1:100) {
  set.seed(i)  # reproducibility
  cross.val <- sample(1:nrow(cv_model_data), 0.7 * nrow(cv_model_data), replace = FALSE)
  training.set <- cv_model_data[cross.val, ]
  test.set <- cv_model_data[-cross.val, ]
  
  # Drop unused factor levels (again, just in case)
  training.set <- droplevels(training.set)
  test.set <- droplevels(test.set)

  # Fit the model
  cv.model <- lm(W8DINCW ~ ., data = training.set)

  # Prediction errors
  in.error <- predict(cv.model, training.set) - training.set$W8DINCW
  out.error <- predict(cv.model, test.set) - test.set$W8DINCW

  # Mean squared errors
  in.sample.mse[i] <- mean(in.error^2)
  out.sample.mse[i] <- mean(out.error^2)
}

# Final averages
mean(in.sample.mse)
mean(out.sample.mse)

```



Complete case:

view the data:
```{r}
vars_to_keep <- c(
  "W8DINCW",
  "W1wrk1aMP", "W1hiqualmum", "W1famtyp2",
  "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1disabYP", "W2disc1YP", 
  "W4CannTryYP" ,"W4schatYP", "W5EducYP", "W5Apprent1YP" , "W6JobYP", "W6UnivYP", "W6OwnchiDV", "W6DebtattYP", "W8CMSEX", "hh_income_quintile"
)

```


```{r}
inc_data_cc_rq1 <-inc_data
```

remove the Missing levels:

```{r}

inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W1wrk1aMP != "Missing")
inc_data_cc_rq1$W1wrk1aMP <- droplevels(inc_data_cc_rq1$W1wrk1aMP)

inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W1nssecfam != "Missing")
inc_data_cc_rq1$W1nssecfam <- droplevels(inc_data_cc_rq1$W1nssecfam)


inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W1ethgrpYP != "Missing")
inc_data_cc_rq1$W1ethgrpYP <- droplevels(inc_data_cc_rq1$W1ethgrpYP)


inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W1heposs9YP != "Missing")
inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W1heposs9YP != "Don't know")
inc_data_cc_rq1$W1heposs9YP <- droplevels(inc_data_cc_rq1$W1heposs9YP)


inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W2disc1YP != "Missing")
inc_data_cc_rq1$W2disc1YP <- droplevels(inc_data_cc_rq1$W2disc1YP)


inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W5EducYP != "Missing")
inc_data_cc_rq1$W5EducYP <- droplevels(inc_data_cc_rq1$W5EducYP)

inc_data_cc_rq1 <- subset(inc_data_cc_rq1, W8DACTIVITY != "Missing")
inc_data_cc_rq1$W8DACTIVITY <- droplevels(inc_data_cc_rq1$W8DACTIVITY)

inc_data_cc_rq1 <- subset(inc_data_cc_rq1, hh_income_quintile != "NA")
inc_data_cc_rq1$hh_income_quintile <- droplevels(inc_data_cc_rq1$hh_income_quintile)

```



```{r}
model_1_cc <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC -W8DACTIVITY
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids  
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum   -W1hiqualdad -W1NoldBroHS  -W1usevcHH
            
            -W4empsYP -W1alceverYP
            
            -W1hwndayYP -W2ghq12scr 
              , data=inc_data_cc_rq1)

display(model_1_cc)
summary(model_1_cc)
Anova(model_1_cc)
```



```{r}
model_2_cc <-  lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids  
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum   -W1hiqualdad -W1NoldBroHS  -W1usevcHH
            
            -W4empsYP -W1alceverYP
            
            -W1hwndayYP -W2ghq12scr 
            
            -W8DACTIVITY -hh_income_quintile
              , data=inc_data_cc_rq1)

display(model_2_cc)
summary(model_2_cc)
Anova(model_2_cc)
```





Outlier Analysis 

```{r}
model_2_cc.outliers <- show_outliers(model_2_cc, topN = 10)
model_2_cc.outliers
all_outlier_ids <- c(
  model_2_cc.outliers$Std.res,
  model_2_cc.outliers$Leverage,
  model_2_cc.outliers$DFFITS,
  model_2_cc.outliers$Cooks
)

# Count how often each point appears
outlier_counts <- table(all_outlier_ids)

multi_violators <- as.numeric(names(outlier_counts[outlier_counts > 1]))

# Print them
cat("Points that violate more than one criterion:\n")
print(multi_violators)
```



```{r}
plot_outlier_diagnostics(model_2_cc)
```


```{r}
model_2_cc_data <- model_2_cc$model
full_no_outliers <- model_2_cc_data[-all_outlier_ids, ]
model_2_cc_no_outlier <- lm(
             W8DINCW ~. -W1GrssyrHH -W1GrssyrMP  -W1wrkfullmum -W1wrkfulldad  -W1empsmum -W1empsdad -W4Childck1YP  -W6NEETAct -W8DWRK -W8DACTIVITYC
              
             -W1ch0_2HH -W1ch3_11HH -W1ch12_15HH -W1ch16_17HH -W1depkids  
            
             -W1InCarHH  -W1truantYP -W1bulrc -W1yschat1  -W4NamesYP -W4RacismYP -W5JobYP -W6EducYP -W6gcse -W6als -W8DGHQSC -W8DMARSTAT -W8TENURE -W8QDEB2 -W8QMAFI 
             
             -W1condur5MP -W1hous12HH -W2depressYP -W6acqno -IndSchool -W1hea2MP -W4AlcFreqYP
             
            -W1marstatmum   -W1hiqualdad -W1NoldBroHS  -W1usevcHH
            
            -W4empsYP -W1alceverYP
            
            -W1hwndayYP -W2ghq12scr 
            
            -W8DACTIVITY -hh_income_quintile
              , data=full_no_outliers)

summary(model_2_cc_no_outlier)
Anova(model_2_cc_no_outlier)
vif(model_2_cc_no_outlier)

```


## cross validation
```{r}
vars_complete_case <- c(
  "W8DINCW", "W1wrk1aMP", "W1hiqualmum", "W1famtyp2", "W1nssecfam", "W1ethgrpYP",
  "W1heposs9YP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W4schatYP",
  "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6OwnchiDV",
  "W6DebtattYP", "W8CMSEX"
)
```


```{r}
cv_model_data_cc <- inc_data_cc_rq1[, vars_complete_case]
cv_model_data_cc <- droplevels(cv_model_data_cc)
```



```{r}

in.sample.mse.cc <- rep(NA, 100)
out.sample.mse.cc <- rep(NA, 100)

for (i in 1:100) {
  set.seed(i)
  cross.val <- sample(1:nrow(cv_model_data_cc), 0.7 * nrow(cv_model_data_cc), replace = FALSE)
  training.set <- cv_model_data_cc[cross.val, ]
  test.set <- cv_model_data_cc[-cross.val, ]
  
  # Drop unused factor levels
  training.set <- droplevels(training.set)
  test.set <- droplevels(test.set)
  
  # Fit the model
  cv.model.cc <- lm(W8DINCW ~ ., data = training.set)
  
  # Prediction errors
  in.error <- predict(cv.model.cc, training.set) - training.set$W8DINCW
  out.error <- predict(cv.model.cc, test.set) - test.set$W8DINCW
  
  # MSEs
  in.sample.mse.cc[i] <- mean(in.error^2)
  out.sample.mse.cc[i] <- mean(out.error^2)
}

# Final averages
mean(in.sample.mse.cc)
mean(out.sample.mse.cc)

```





```{r}
AIC(model_8)

AIC(model_9)
```





